<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>JaveCupos Â· Test Client (Completo)</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
  </head>
  <body>
    <div class="app">
      <header class="app-header">
        <h1>ğŸš— JaveCupos â€” Test Client</h1>
        <div class="header-controls">
          <label>Backend URL:
            <input id="backend-url" value="http://localhost:3000" />
          </label>
          <button id="save-backend">Guardar</button>
          <div id="user-info-header" class="user-info-header hidden">
            <span id="user-name-header">-</span>
            <span id="user-role-header">-</span>
            <button id="btn-logout-header" class="btn-small">Logout</button>
          </div>
        </div>
      </header>

      <!-- Tabs Navigation -->
      <nav class="tabs-nav">
        <button class="tab-btn active" data-tab="auth">ğŸ” Auth</button>
        <button class="tab-btn" data-tab="cupos">ğŸš— Cupos</button>
        <button class="tab-btn" data-tab="bookings">ğŸ“… Reservas</button>
        <button class="tab-btn" data-tab="users">ğŸ‘¥ Usuarios</button>
        <button class="tab-btn" data-tab="notifications">ğŸ”” Notificaciones</button>
        <button class="tab-btn" data-tab="test-cases">ğŸ§ª Test Cases</button>
        <button class="tab-btn" data-tab="generic">ğŸŒ Generic API</button>
        <button class="tab-btn" data-tab="websocket">âš¡ WebSocket</button>
      </nav>

      <main class="main-content">
        <!-- Auth Tab -->
        <section class="tab-content active" id="tab-auth">
          <div class="panel-grid">
            <div class="panel">
              <h2>ğŸ” AutenticaciÃ³n</h2>
              <div class="auth-forms">
                <div class="form-block">
                  <h3>Login</h3>
                  <input id="login-email" placeholder="email@example.com" />
                  <input id="login-password" type="password" placeholder="contraseÃ±a" />
                  <button id="btn-login">Iniciar sesiÃ³n</button>
                </div>

                <div class="form-block">
                  <h3>Registro</h3>
                  <input id="reg-name" placeholder="Nombre" />
                  <input id="reg-email" placeholder="email@example.com" />
                  <input id="reg-password" type="password" placeholder="contraseÃ±a" />
                  <input id="reg-phone" placeholder="TelÃ©fono" />
                  <input id="reg-age" type="number" placeholder="Edad" min="1" max="120" />
                  <select id="reg-role">
                    <option value="">Selecciona un rol</option>
                    <option value="usuario">Usuario</option>
                    <option value="conductor">Conductor</option>
                    <option value="administrador">Administrador</option>
                  </select>
                  <button id="btn-register">Registrar</button>
                </div>
              </div>

              <div class="session-area">
                <div id="user-info" class="hidden">
                  <strong id="user-name">-</strong>
                  <div id="user-role">-</div>
                  <div class="token-box">
                    <label>JWT:</label>
                    <textarea id="token-storage" readonly></textarea>
                  </div>
                  <button id="btn-logout">Cerrar sesiÃ³n</button>
                </div>
              </div>
            </div>

            <div class="panel">
              <h2>ğŸ“§ GestiÃ³n de Cuenta</h2>
              <div class="form-block">
                <h3>Verificar Email</h3>
                <input id="verify-token" placeholder="Token de verificaciÃ³n" />
                <button id="btn-verify-email">Verificar</button>
              </div>

              <div class="form-block">
                <h3>Reenviar VerificaciÃ³n</h3>
                <input id="resend-email" placeholder="email@example.com" />
                <button id="btn-resend-verification">Reenviar</button>
              </div>

              <div class="form-block">
                <h3>Recuperar ContraseÃ±a</h3>
                <input id="forgot-email" placeholder="email@example.com" />
                <button id="btn-forgot-password">Enviar</button>
              </div>

              <div class="form-block">
                <h3>Restablecer ContraseÃ±a</h3>
                <input id="reset-token" placeholder="Token de recuperaciÃ³n" />
                <input id="reset-password" type="password" placeholder="Nueva contraseÃ±a" />
                <button id="btn-reset-password">Restablecer</button>
              </div>

              <div class="form-block">
                <h3>Perfil</h3>
                <button id="btn-get-profile">Obtener Perfil</button>
              </div>
            </div>
          </div>
        </section>

        <!-- Cupos Tab -->
        <section class="tab-content" id="tab-cupos">
          <div class="panel-grid">
            <div class="panel">
              <h2>ğŸš— Crear Cupo</h2>
              <div class="form-block">
                <select id="cupo-destino" placeholder="Destino/Barrio">
                  <option value="">Selecciona destino</option>
                </select>
                <input id="cupo-punto" placeholder="Punto de encuentro" />
                <input id="cupo-descripcion" placeholder="DescripciÃ³n (opcional)" />
                <input id="cupo-asientos" type="number" value="4" min="1" max="8" placeholder="Asientos totales" />
                <input id="cupo-hora" type="datetime-local" />
                <input id="cupo-precio" type="number" placeholder="Precio" min="0" step="0.01" />
                <input id="cupo-telefono" placeholder="TelÃ©fono contacto (opcional)" />
                <button id="btn-create-cupo">Crear Cupo</button>
              </div>
            </div>

            <div class="panel">
              <h2>ğŸ“‹ Listar Cupos</h2>
              <button id="btn-list-cupos">Listar Todos</button>
              <button id="btn-my-cupos">Mis Cupos</button>
              <button id="btn-cupo-details">Ver Detalles</button>
              <input id="cupo-id-details" type="number" placeholder="ID del cupo" />
            </div>

            <div class="panel">
              <h2>ğŸ” BÃºsqueda Avanzada</h2>
              <select id="search-destino">
                <option value="">Todos los destinos</option>
              </select>
              <input id="search-fecha" type="date" />
              <input id="search-asientos-min" type="number" min="1" placeholder="Asientos mÃ­nimos" />
              <input id="search-precio-min" type="number" min="0" placeholder="Precio mÃ­nimo" />
              <input id="search-precio-max" type="number" min="0" placeholder="Precio mÃ¡ximo" />
              <select id="search-estado">
                <option value="">Todos los estados</option>
                <option value="Disponible">Disponible</option>
                <option value="En curso">En curso</option>
                <option value="Completado">Completado</option>
                <option value="Cancelado">Cancelado</option>
              </select>
              <button id="btn-search-cupos">Buscar</button>
            </div>

            <div class="panel">
              <h2>âœï¸ Gestionar Cupo</h2>
              <input id="cupo-id-update" type="number" placeholder="ID del cupo" />
              <input id="cupo-update-punto" placeholder="Nuevo punto de encuentro" />
              <input id="cupo-update-descripcion" placeholder="Nueva descripciÃ³n" />
              <input id="cupo-update-asientos" type="number" placeholder="Nuevos asientos disponibles" />
              <input id="cupo-update-precio" type="number" placeholder="Nuevo precio" />
              <button id="btn-update-cupo">Actualizar Cupo</button>
              <button id="btn-cancel-cupo">Cancelar Cupo</button>
              <button id="btn-delete-cupo" class="btn-danger">Eliminar Cupo (Admin)</button>
            </div>
          </div>
        </section>

        <!-- Bookings Tab -->
        <section class="tab-content" id="tab-bookings">
          <div class="panel-grid">
            <div class="panel">
              <h2>ğŸ“… Crear Reserva</h2>
              <div class="form-block">
                <input id="booking-cupo-id" type="number" placeholder="ID del Cupo" />
                <input id="booking-asientos" type="number" value="1" min="1" max="8" placeholder="Asientos a reservar" />
                <button id="btn-create-booking">Reservar</button>
              </div>
            </div>

            <div class="panel">
              <h2>ğŸ“‹ Mis Reservas</h2>
              <button id="btn-my-bookings">Ver Mis Reservas</button>
              <button id="btn-all-bookings">Todas (Admin/Driver)</button>
              <input id="booking-cupo-filter" type="number" placeholder="Filtrar por Cupo ID" />
              <button id="btn-bookings-by-cupo">Reservas del Cupo</button>
            </div>

            <div class="panel">
              <h2>âœ… Gestionar Reserva</h2>
              <input id="booking-id-manage" type="number" placeholder="ID de la Reserva" />
              <div class="button-group">
                <button id="btn-confirm-booking" class="btn-success">Confirmar (Conductor)</button>
                <button id="btn-reject-booking" class="btn-warning">Rechazar (Conductor)</button>
                <button id="btn-cancel-booking" class="btn-danger">Cancelar (Usuario)</button>
              </div>
            </div>
          </div>
        </section>

        <!-- Users Tab -->
        <section class="tab-content" id="tab-users">
          <div class="panel-grid">
            <div class="panel">
              <h2>ğŸ‘¥ Usuarios</h2>
              <button id="btn-all-users">Listar Todos</button>
              <button id="btn-user-details">Ver Usuario</button>
              <input id="user-id-details" type="number" placeholder="ID del usuario" />
            </div>

            <div class="panel">
              <h2>ğŸ” BÃºsqueda</h2>
              <input id="search-user-name" placeholder="Nombre" />
              <input id="search-user-email" placeholder="Email" />
              <select id="search-user-role">
                <option value="">Todos los roles</option>
                <option value="usuario">Usuario</option>
                <option value="conductor">Conductor</option>
                <option value="administrador">Administrador</option>
              </select>
              <button id="btn-search-users">Buscar</button>
            </div>

            <div class="panel">
              <h2>âœï¸ Gestionar Usuario</h2>
              <input id="user-id-manage" type="number" placeholder="ID del usuario" />
              <input id="user-update-name" placeholder="Nuevo nombre" />
              <input id="user-update-phone" placeholder="Nuevo telÃ©fono" />
              <input id="user-update-age" type="number" placeholder="Nueva edad" />
              <button id="btn-update-user">Actualizar Usuario</button>
              <button id="btn-delete-user" class="btn-danger">Eliminar Usuario</button>
            </div>

            <div class="panel">
              <h2>â• Crear Usuario</h2>
              <input id="create-user-name" placeholder="Nombre" />
              <input id="create-user-email" placeholder="Email" />
              <input id="create-user-password" type="password" placeholder="ContraseÃ±a" />
              <input id="create-user-phone" placeholder="TelÃ©fono" />
              <input id="create-user-age" type="number" placeholder="Edad" />
              <select id="create-user-role">
                <option value="usuario">Usuario</option>
                <option value="conductor">Conductor</option>
                <option value="administrador">Administrador</option>
              </select>
              <button id="btn-create-user">Crear Usuario</button>
            </div>
          </div>
        </section>

        <!-- Notifications Tab -->
        <section class="tab-content" id="tab-notifications">
          <div class="panel-grid">
            <div class="panel">
              <h2>ğŸ”” Notificaciones</h2>
              <div class="notification-controls">
                <button id="btn-my-notifications">Mi Bandeja</button>
                <button id="btn-pending-notifs">Pendientes</button>
                <button id="btn-unread-count">Conteo Sin Leer</button>
                <button id="btn-mark-all-read">Marcar Todas LeÃ­das</button>
                <button id="btn-refresh-notifications">ğŸ”„ Actualizar</button>
              </div>
              <div id="unread-count-display" class="unread-count-display"></div>
            </div>

            <div class="panel full-width">
              <h2>ğŸ“‹ Lista de Notificaciones</h2>
              <div id="notifications-list" class="notifications-list">
                <p class="text-muted">Carga tus notificaciones para verlas aquÃ­</p>
              </div>
            </div>

            <div class="panel">
              <h2>â• Crear NotificaciÃ³n</h2>
              <input id="create-notif-user-id" type="number" placeholder="User ID (opcional)" />
              <select id="create-notif-type">
                <option value="Reserva creada">Reserva creada</option>
                <option value="Reserva confirmada">Reserva confirmada</option>
                <option value="Reserva cancelada">Reserva cancelada</option>
                <option value="Cupo creado">Cupo creado</option>
                <option value="Cupo modificado">Cupo modificado</option>
                <option value="Cupo cancelado">Cupo cancelado</option>
              </select>
              <textarea id="create-notif-message" placeholder="Mensaje"></textarea>
              <button id="btn-create-notif">Crear NotificaciÃ³n</button>
            </div>
          </div>
        </section>

        <!-- Test Cases Tab -->
        <section class="tab-content" id="tab-test-cases">
          <div class="panel-grid">
            <div class="panel">
              <h2>ğŸ§ª Casos de Prueba Preconfigurados</h2>
              <div class="test-cases">
                <h3>Flujos Completos</h3>
                <button class="test-case-btn" data-test="flow-register-verify-login">1. Registro â†’ VerificaciÃ³n â†’ Login</button>
                <button class="test-case-btn" data-test="flow-create-cupo-booking">2. Crear Cupo â†’ Reservar â†’ Confirmar</button>
                <button class="test-case-btn" data-test="flow-booking-reject">3. Crear Reserva â†’ Rechazar</button>
                <button class="test-case-btn" data-test="flow-cancel-cupo">4. Crear Cupo â†’ Cancelar</button>
                
                <h3>Casos de Error</h3>
                <button class="test-case-btn" data-test="error-duplicate-email">Email Duplicado</button>
                <button class="test-case-btn" data-test="error-invalid-credentials">Credenciales InvÃ¡lidas</button>
                <button class="test-case-btn" data-test="error-unauthorized">Sin AutenticaciÃ³n</button>
                <button class="test-case-btn" data-test="error-forbidden">Sin Permisos</button>
                <button class="test-case-btn" data-test="error-past-date">Fecha Pasada</button>
                <button class="test-case-btn" data-test="error-insufficient-seats">Asientos Insuficientes</button>
                <button class="test-case-btn" data-test="error-duplicate-booking">Reserva Duplicada</button>
                <button class="test-case-btn" data-test="error-own-cupo">Reservar Propio Cupo</button>
                
                <h3>Validaciones</h3>
                <button class="test-case-btn" data-test="validate-cupo-update-permissions">Permisos Actualizar Cupo</button>
                <button class="test-case-btn" data-test="validate-booking-confirm-permissions">Permisos Confirmar Reserva</button>
                <button class="test-case-btn" data-test="validate-booking-state">Estados de Reserva</button>
                <button class="test-case-btn" data-test="validate-seats-calculation">CÃ¡lculo de Asientos</button>
              </div>
            </div>

            <div class="panel">
              <h2>ğŸ“Š Resultados de Tests</h2>
              <div id="test-results" class="test-results">
                <p class="text-muted">Ejecuta un caso de prueba para ver resultados</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Generic API Tab -->
        <section class="tab-content" id="tab-generic">
          <div class="panel full-width">
            <h2>ğŸ§ª Tester GenÃ©rico</h2>
            <div class="form-row">
              <select id="req-method">
                <option>GET</option>
                <option>POST</option>
                <option>PUT</option>
                <option>PATCH</option>
                <option>DELETE</option>
              </select>
              <input id="req-path" placeholder="/auth/profile" />
              <button id="btn-send">Enviar</button>
            </div>
            <textarea id="req-body" placeholder='JSON body para POST/PUT/PATCH'></textarea>
            <div class="result">
              <h4>Respuesta <span id="response-status" class="status-badge"></span></h4>
              <pre id="response"></pre>
            </div>
          </div>
        </section>

        <!-- WebSocket Tab -->
        <section class="tab-content" id="tab-websocket">
          <div class="panel full-width">
            <h2>âš¡ WebSocket / Notificaciones</h2>
            <div class="ws-controls">
              <button id="ws-connect">Conectar WS</button>
              <button id="ws-disconnect" disabled>Desconectar</button>
              <button id="ws-request-notifs">Pedir notificaciones</button>
              <button id="ws-mark-all">Marcar todas leÃ­das</button>
            </div>
            <div class="ws-log">
              <h4>Eventos</h4>
              <div id="ws-log-area" class="log"></div>
            </div>
          </div>
        </section>
      </main>


      <footer class="footer">
        <small>Cliente de pruebas completo â€” Todos los endpoints | JWT persistente | WebSocket en tiempo real</small>
      </footer>
    </div>

    <script type="module" src="app.js"></script>
  </body>
</html>
